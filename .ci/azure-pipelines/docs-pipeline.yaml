trigger:
  paths:
    include:
    - doc

pr:
  paths:
    include:
    - doc

resources:
  pipelines:
    - pipeline: Build-CI
      source: Build
      trigger:
        stages:
        - build_gcc
  containers:
    - container: fmt # for formatting.yaml
      image: pointcloudlibrary/fmt
    - container: doc # for documentation.yaml
      image: pointcloudlibrary/doc
    - container: env1804 # for tutorials.yaml
      image: pointcloudlibrary/env:18.04

variables:
  isTriggeredByBuild: $[eq(variables['Build.Reason'], 'ResourceTrigger')]

stages:
  - stage: formatting
    displayName: Formatting
    # if docs pipeline triggered by build_gcc stage,
    # the formatting stage has already run, thus it
    # won't run for a second time here.
    condition: not(isTriggeredByBuild)
    jobs:
      - template: formatting.yaml

  - stage: documentation
    displayName: Documentation
    condition: or(succeeded(), isTriggeredByBuild)
    jobs:
      - template: documentation.yaml

  - stage: tutorials
    displayName: Tutorials
    jobs:
      - template: tutorials.yaml
